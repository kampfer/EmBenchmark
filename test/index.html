<html>

<head>
    <title>Embedded Benchmark</title>
</head>

<body>
    <div id="root"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.15/lodash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/platform/1.3.5/platform.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/benchmark/2.1.4/benchmark.min.js"></script>
    <script src="../EmBenchmark.js"></script>

    <script type="text/setup" id="setup">
        function someFn(ix) {
            return ix * 5 + 1 / 3 * 8;
        }

        let arr = [];
        for (let i = 0; i < 1000; i++) {
            arr[i] = i;
        }
    </script>

    <script>
        let setup = document.getElementById('setup').innerText;

        new EmBenchmark.default({
            root: document.getElementById('root'),
            benchmarks: [{
                name: 'For loop, basic',
                fn: function() {
                    for (var i = 0; i < arr.length; i++) {
                        someFn(arr[i]);
                    }
                },
                // setup必须作为参数传入，不能在全局执行，否则结果会异常：forEach反而最快
                setup
            }, {
                name: 'For loop, cached',
                fn: function() {
                    for (var i = 0, len = arr.length; i < len; i++) {
                        someFn(arr[i]);
                    }
                },
                setup
            }, {
                name: 'ForEach loop',
                fn: function() {
                    arr.forEach(function (item) {
                        someFn(item);
                    });
                },
                setup
            }]
        });
    </script>
</body>

</html>